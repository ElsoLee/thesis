%# -*- coding: utf-8-unix -*-
%%==================================================
%% conclusion.tex for SJTUThesis
%% Encoding: UTF-8
%%==================================================

\chapter{总结与展望}
\label{chap:summary}
\section{本文总结}
随着互联网行业的发展，如今的互联网正处于一个信息爆炸的时代。面对信息爆炸的互联网，对信息的存储和处理也就产生了海量的数据。为了高可用性和节约资源，IaaS云常常被用来部署大数据分析和其他各种类型的应用。
虚拟机被认为构建IaaS云的基础，而虚拟机常常是基于虚拟机磁盘镜像（VMDI）构建的。传统的云存储解决方案，如NAS越来越难以适应大量的云存储需求，对象存储由于其高扩展性可以更好地适应现在的大规模云存储。
存储介质方面，SSD由于其读写性能优势以及较低的能耗被越来越多地运用在数据中心的存储中。但是，SSD的价格还是非常的昂贵，难以适应大规模数据中心的存储需求，所以将SSD与传统HDD构件混合存储系统则是一个主流。
而近些年被提出的软件定义存储，由于其简化了虚拟机存储的端到端开销，并且通过自治的方式对存储集群的结构进行优化，使它更加适合运用于混合存储系统。

本实验室学长之前的针对虚拟机块存储所研究的软件定义的混合存储系统MOBBS和WHOBBS，都是动态监测虚拟机数据对象的访问频率和访问类型然后做出合适的迁移策略，使得较“热”的对象总是分布在SSD上而较“冷”的对象总是分布在HDD上。
WHOBBS是MOBBS的升级版本，它对MOBBS的客户端性能进行了优化。而WHOBBS则是一个单监控器架构的混合存储系统，我们知道单监控器就必须面临单点故障或压力过大的问题。

为了解决WHOBBS单监控器架构所带来的性能问题，我们提出了DOBBS，一个两层多监控架构的软件定义的混合存储系统。DOBBS与WHOBBS的不同在于，我们有多个Monitor，它们将整个集群划分成多个子集群，子集群相对独立并且由一个Monitor进行管理。
我们提出了两个重要的概念，分别是局部热均衡和全局热均衡。局部热均衡只是针对每个子集群内部的局部热均衡，因此每个Monitor只能保证所在子集群的局部热均衡，它的根本目标就是让热对象放置于SSD，让冷对象放置于HDD。局部热均衡的设计
是沿用WHOBBS，我们只是做出了比较小的修改。全局热均衡则是在多子集群架构之后，可能会出现某个子集群遭受较大数据流而导致子集群间热度不均衡的情况，引入的概念。全局热均衡主要包括两个部分的内容，分别是热度不均衡的检测和热扩散过程。
热度不均衡的检测中，我们提出了衡量子集群热度的方法以及热度检测的算法。热扩散是全局热均衡的重点，主要包括使能过程和懒迁移过程。为了解决大规模数据迁移，我们提出了全新的概念——热扩散，这一概念是源自于物理学的热扩散。我们只对
元数据进行迁移，并且修改子集群的逻辑结构，而后续的数据迁移则是交给局部热均衡来完成的。全局热均衡的过程也是软件定义的，全局热均衡根据每个子集群的热度本身来重新修改各个子集群的逻辑结构，从而
使得整个系统达到热均衡的状态，这样则让系统自治地对存储集群的机构进行优化，并且整个过程对上层应用并不可见。

在介绍系统的设计之后，我们对DOBBS的系统实现进行了详细的介绍，为了防止避重就轻，我们将WHOBBS的实现部分做了很大程度的省略。在实现DOBBS，我们选用了现在主流的Ceph提供对象存储，QEMU作为虚拟机管理程序，Apache Thrift作为模块间远程过程
调用框架。我们将系统的类图做出了详细的绘制，包括每个类的设计细节和各个接口的介绍。值得注意的是，在WHOBBS的基础上我们增加了Center服务器，所以Center服务器是我们系统实现的重点与关键。我们还介绍了系统几个重要的工作流程，它们是通过UML
时序图的方式绘制的，然后我们对它们也做了详细的解释。

在论文的最后，我们需要实验来验证DOBBS的高效性和高可用性，于是我们对实验的物理环境和软件环境进行了搭建。我们采用了8个OSD来表示存储集群，并用4个Monitor来将存储集群分割成4个子集群。对于局部热均衡的实验验证在WHOBBS的论文中已经验证过，
所以本文并没有针对局部热均衡进行大量的实验验证。而对于全局热均衡，我们主要从两个角度进行的验证，分别是比较DOBBS与WHOBBS的Monitor在相同数据流下的资源利用差距，以及DOBBS的全局热均衡的有效性。对于后者，我们又实现了一个没有全局热均衡
功能的DOBBS，让它与原生DOBBS进行比较。大量实验证明，DOBBS解决了WHOBBS的Monitor的性能问题，同样也验证了全局热均衡的有效性。

综上所述，我们设计并实现了一个高效的分布式混合块存储系统，它不仅可以从SSD/HDD的层面充分利用SSD的性能优势，还能做到分布式监控节点的负载均衡。在文章的最后，我们还通过实验验证了设计的高效性和实现的可行性。

\section{未来展望}
我们在第\ref{chap:systemdesign}章曾叙述过DOBBS的设计目标是解决WHOBBS的系能问题，但是我们论述了WHOBBS所保存的数据并不是十分重要，因此我们实际上忽略了当Monitor宕机之后存在的问题。所以，我们在未来应该利用一致性协议或者多版本技术
来保证Monitor宕机之后子集群仍能进行局部热均衡，例如将它所有的OSD划归到其他子集群中。

在系统实现中，我们实际并没有用到Raft协议来作为Monitor之间的一致性协议，而是使用了一个单独的服务器作为Center。因此，后续的研究和实现可以从这里出发，实现将Monitor与Center整合，并通过
Raft解决快速错误恢复。

其次，本论文仅仅探索了SSD和HDD这两种存储介质，那么多余种类繁多的存储介质，应该有一种通用的方案来解决存储介质间迁移的策略。

