%# -*- coding: utf-8-unix -*-
%%==================================================
%% chapter01.tex for SJTU Master Thesis
%%==================================================

%\bibliographystyle{sjtu2}%[此处用于每章都生产参考文献]
\chapter{绪论}
\label{chap:intro}

\section{研究背景}
随着互联网行业的发展，如今的互联网正处于一个信息爆炸的时代。面对信息爆炸的互联网，对信息的存储和处理也就产生了海量的数据。
因此，传统的数据中心在性能、成本、安全和能耗上遇到了越来越多的挑战。为了应对海量数据带来的挑战，国内外一些大型IT公司都建立了各自的云系统和解决方案，
如亚马逊的AWS、微软的Azure、阿里巴巴的阿里云、百度的百度云等等。

为了高可用性和节约资源，IaaS（Infrastructure as a Service）云常常被用来部署大数据分析和其他各种类型的应用。 IaaS是以体系架构为基础的服务，
这些服务包括服务器、存储和网络硬件的提供。可是，如果以物理机的方式提供这些计算资源，那么成本将难以估计并且会造成大量资源的浪费。取而代之，现在的云提供商
选择以虚拟化技术来代替物理设备，这样充分降低了成本并且提升了可用性和可扩展性。在IaaS云，云提供商通过虚拟机监控程序虚拟化一台物理机，这样的虚拟化技术让
一台物理机运行多台虚拟机成为可能\cite{feng2014price}。因此，虚拟机被认为构建IaaS云的基础，而虚拟机常常是基于虚拟机磁盘镜像（VMDI）构建的。传统的云
存储解决方案，如NAS(Network Attached Storage)越来越难以适应大量的云存储需求，考虑到NAS的扩展性低、对非结构化数据没有优化的特点，用NAS存储虚拟机
磁盘镜像则毫无优势。相较于传统的NAS存储，对象存储由于其高扩展性可以更好地适应现在的大规模云存储。对象存储可以让云提供商轻松地扩大存储规模，并且它通过
备份数据副本的方式保证了存储的高可用性，更加重要的是对象存储允许存储大规模的非结构化的数据。对象存储是以对象为粒度管理数据，与之相对应的就是文件系统存储和块存储。
对象存储的一个重要设计原则就是抽象底层存储，使得底层存储于上层应用分离开来。对象包含了额外的描述性信息和属性，这样可以让对象可以被快速地索引和查找
现在一些云服务提供商，如亚马逊（AWS S3），微软（Microsoft Azure），还有一些开源项目如，OpenStack（Swift）、Ceph和OpenIO等等都是基于对象存储的。

对于存储介质方面，目前的主流存储介质包括了半导体存储和磁性磁性存储两大种类。对于半导体存储，其早在2006年笔记本和个人PC厂家就开始使用的SSD逐渐替代更多传统的磁体存储器HDD。
与传统机械硬盘HDD相比，SSD访问更加快速、可靠、低能效，但也更昂贵。在大量实验比较下，SSD的随机访问时间一般少于1ms，而HDD的随机访问时间则是在2.9至12ms之间，因此SSD的随
机访问速度是HDD的10倍以上\cite{kasavajhala2011solid}。纵然，SDD在性能、能耗等方面相较于HDD有较大的优势，但是由于其高昂的价格与存储空间比如传统硬盘仍有较大差距。
一个SATA WCD SSD的存储成本是1.375美元/GB，一个SATA WCD HDD的存储成本是0.068美元/GB。为了充分利用SSD的性能潜力，现在关于混合存储的研究主要是将SSD作为前端存储（缓存）
或作为主存。如果将SSD作为存储缓存则必须面对两个主要问题：缓存和主存之间的一致性问题以及SSD的容量浪费问题。那么，如果将SSD作为主存，那么混合存储的关键性问题在于把哪些对象放置于SSD。

实验室学长在本文开始之前已经有了关于混合存储的的研究，分别是WHOBBS\cite{lingxuan2015whobbs}和MOBBS\cite{ma2014mobbs}，它们基于对象存储为虚拟机提供混合存储的块服务。
它们都在Ceph\cite{weil2006ceph}的基础上，构建了一套完整的混合存储系统。它们最根本的思路是，将过热的数据放置在SSD上，反之将较冷的数据放置在HDD上。这两个系统都是通过数据
对象的数据流监控，数据流包括数据对象的大小、特定的访问类型等等信息。它们将这些数据流信息进行处理之后得到每个对象的热度值，然后根据每个对象的热度值制定一个合适的迁移策略，使得
每一个对象对象都放置在合适的存储设备上。WHOBBS是MOBBS的升级版本。MOBBS将对数据流的监控分析模块和虚拟机管理器都放在客户端节点，因为监控分析模块会占用客户端节点的计算资源，这
样势必会直接影响到虚拟机管理器和虚拟机的运行效率。WHOBBS在MOBBS的基础上修正了这个问题，它把监控分析模块分离出来，放在一个独立的节点上去运行，它叫做Monitor。这样就是支持多个
客户端节点同时运行，并且把MOBBS存在的性能隐患也完全消除。WHOBBS相较于MOBBS虽然可以很高效，但是考虑到WHOBBS是单监控节点架构，那么当客户端的数量增加起来之后，监控节点的计算压
力也会随之增长。这样势必还是会影响到整个系统的性能。不仅如此，因为WHOBBS的Monitor成为了整个系统的关键性节点，那么Monitor节点一旦宕机，整个系统都不能正确运行。

\section{研究目标和内容}
正如上文所说的，利用SSD和HDD构建混合存储可以充分利用SSD的高性能优势也可是有个相对经济的价格，并且由于现在IaaS云中存储的主要数据也是虚拟机VMDI，那么利用混合存储为虚拟机VMDI提供块存储
服务。本课题的研究目标就是构建一个高可靠、高可用性的混合存储系统。因此，我解决了上文提到的WHOBBS存在的性能缺陷，设计并实现一个中心化双层系统————DOBBS。因为DOBBS是也是基于Ceph的，并且将
实际的文件存储在对象存储设备（Object Storage Devices）中。通过修改Ceph的相关源代码，DOBBS的底层实现对上层用户是透明的。为了解决WHOBBS的性能缺陷，DOBBS将WHOBBS原有的Monitor节点
的功能分摊到多个同级Monitor上，它们的实际功能和WHOBBS的Monitor节点的功能相似，监测虚拟机的数据流信息并制定合适的迁移策略。但是和WHOBBS不同的是，DOBBS运用的是中心化双层的Monitor架构。基于这个架构，存储集群被
分割成了多个子集群，每个子集群又由独立的Monitor节点所控制。DOBBS提出了热均衡的概念，热均衡旨在将集群过热的节点数据进行迁移使得整个集群达到一个宏观上负载均衡的状态。对于DOBBS，我们又将热均衡
分为两类：局部热均衡和全局热均衡。局部热均衡指的是对于每个子集群内部的数据根据其热度数据合理地分布在SSD/HHD中。DOBBS又提出了一个全局热均衡的概念，因此DOBBS使用一个被选举出来的Monitor节点作为
中心节点，其他节点通过一致性算法Raft\cite{ongaro2014search}，来进行数据本分和快速错误恢复。

本课题的目标是，第一，优化现存分布式混合存储中的监控节点，创建多个监控节点，实现监控节点的分布式，从而保证分布式混合存储系统的高可用性；第二，根据用户行为，对存储内容的访问情况，动态调整存储策略，下层的混合存储实现对用户透明；
第三，混合存储的关注点不再具象到HDD/SDD这两种存储介质，而是探索不同存储介质的特性，动态适应混合存储系统。

\begin{enumerate}[noitemsep,topsep=0pt,parsep=0pt,partopsep=0pt]
	\item 分布拓扑结构监控器：由于在现存的分布式混合存储系统中，都存在一个监控节点，但是由于只有一个监控节点，这样使得管理节点往往成为性能的瓶颈。为了解决这个问题，需要创建多个管理节点，也就是对管理节点分布式。
	\item 分布式全局热均衡：本课题的第一个目标就是创建多个监控节点，实现监控节点的分布式。那么这将带来一个问题，每个监控节点分管不同的混合存储节点，因此监控节点可以较好得保证各自分管的混合存储节点内部的热均衡，但是这只是局部的热均衡并不是全局的。全局热均衡需要提出适当的算法、合适的策略、完善的数据迁移方法。	
	\item 面向多存储介质的数据放置方法：不同存储介质在对不同类型或频率的IO请求都会存在性能上的差异。所以要通过实验来确定存储介质的特性，并根据其性能上的特性设计数据放置方法，然后将计算出的放置方法应用到混合存储的数据迁移策略中。
	\item 实验验证：通过实验验证分布式拓扑结构监控器是否可以解决WHOBBS的性能缺陷，以及采用中心化两层架构后系统的性能和可用使用是否得到了提高。
\end{enumerate}

\section{研究意义}
由于现在IaaS云的流行，越来越多的企业将自己的服务部署在IaaS中。我们知道，IaaS是以计算资源为服务进行商业化出售，而虚拟机则是在IaaS云中扮演至关重要的地位。传统的云存储解决方案，如NAS并不能有良好的可扩展性，并且对于云服务的高可用性也不能
给予保证。相比于NAS，对象存储的高扩展性以及对虚拟机磁盘镜像的存储可以做到十分充分的优化则让它在IaaS存储中崭露头角。另外，在存储介质方面，SSD相比于HDD有着优异的读写性能和较低的能耗，越来越多的厂家选择渐渐用SSD来替代原有的HDD。
可是，SSD又由于其高昂的价格和受限的容量，并不能完全取代HDD。所以，将SSD和HDD混合起来构建混合存储则变得尤为重要。

WHOBBS虽然已经可以高效地将数据在SSD和HDD上动态地迁移，但是WHOBBS的监控器只有一个，因此它就必须承担所有客户端的数据流信息，并且还将面临宕机后整个集群的性能受到影响的问题。
所以解决WHOBBS的监控器所存在的问题则是十分紧迫的。DOBBS在WHOBBS的基础上进行了扩展，我们为了解决单一监控器带来的问题，我们用多个同级的监控器来代替单一监控器，这样就可以把
单一监控器的计算任务平均分配到各个监控器上，这样就充分解决了WHOBBS的监控器所存在的问题。

\section{论文组织结构}
本文正文包含六章，本章为绪论，首先系统性地介绍并分析了本课题的研究背景和研究意义，在此基础上提出了本课题的研究内容和目标。其他章节的内容组织如下：

第\ref{chap:relatedwork}章介绍了和本课题有关的国内外研究现状。该章节从本课题所涉及的研究内容出发，调研并分析了与之相关的现有的国内外研究成果与不足，并提出了可以进一步研究和改进之处。

第\ref{chap:systemdesign}章介绍了本课题提出的分布式混合存储系统的体系架构设计。该章节首先从整体上介绍了分布式混合存储系统的体系架构，之后对架构中的具体模块进行了详细的分析和设计。

第\ref{chap:systemimpl}章介绍了系统实现。该章节分别介绍了分布式混合存储系统的体系架构各个模块的实现。

第\ref{chap:experiment}章介绍了系统实验与验证。该章节详细地介绍了为验证本课题所提出的移动边缘计算的体系架构以及云-端负载平衡的计算迁移机制所进行的实验，并针对实验结果给出了详细的分析。

第\ref{chap:summary}章为总结与展望。该章节总结了本课题的主要研究工作与贡献，并在此基础之上给出了今后的研究方向。